<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
  lang="id"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail Catatan Kesehatan</title>
  </head>
  <body>
    <div layout:fragment="content" class="mt-4">
      <div class="card shadow-sm">
        <!-- Header: Tombol Kembali & Judul -->
        <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
          <div class="d-flex align-items-center gap-3">
            <a th:href="@{/}" class="btn btn-outline-secondary btn-sm">
              &larr; Kembali
            </a>
            <div>
              <h5 class="mb-0 fw-bold">
                Catatan: <span th:text="${record.date}"></span>
              </h5>
              <small class="text-muted">Detail kondisi kesehatan harian</small>
            </div>
          </div>
          
          <!-- Tombol Aksi -->
          <div class="d-flex gap-2">
            <button
              class="btn btn-warning btn-sm text-dark fw-bold"
              data-bs-target="#editPhotoModal"
              data-bs-toggle="modal"
            >
              <i class="bi bi-camera"></i> Upload Foto
            </button>
          </div>
        </div>

        <div class="card-body">
          <div class="row">
            <!-- KOLOM KIRI: Foto Bukti -->
            <div class="col-md-4 text-center mb-4">
              <div th:if="${record.photoUrl}" class="card border-0">
                <img
                  th:src="@{'/health-records/photo/' + ${record.photoUrl}}"
                  alt="Foto Kesehatan"
                  class="img-fluid rounded shadow-sm"
                  style="max-height: 400px; object-fit: cover;"
                />
                <p class="text-muted mt-2 small">Lampiran Foto</p>
              </div>
              
              <!-- Jika belum ada foto -->
              <div th:unless="${record.photoUrl}" class="alert alert-secondary py-5">
                <h1 class="display-4 text-secondary">ðŸ“·</h1>
                <p>Belum ada foto lampiran</p>
                <button
                  class="btn btn-sm btn-link"
                  data-bs-target="#editPhotoModal"
                  data-bs-toggle="modal"
                >
                  Upload sekarang
                </button>
              </div>
            </div>

            <!-- KOLOM KANAN: Data Detail -->
            <div class="col-md-8">
              <h6 class="border-bottom pb-2 mb-3 fw-bold text-primary">Tanda Vital</h6>
              <div class="row g-3 mb-4">
                <!-- Suhu -->
                <div class="col-6 col-md-4">
                  <div class="p-3 border rounded bg-light text-center">
                    <small class="text-muted d-block">Suhu Tubuh</small>
                    <span class="fs-4 fw-bold text-danger">
                      [[${record.bodyTemperature}]]Â°C
                    </span>
                  </div>
                </div>
                <!-- Tensi -->
                <div class="col-6 col-md-4">
                  <div class="p-3 border rounded bg-light text-center">
                    <small class="text-muted d-block">Tekanan Darah</small>
                    <span class="fs-4 fw-bold text-dark">
                      [[${record.bloodPressure != null ? record.bloodPressure : '-'}]]
                    </span>
                  </div>
                </div>
                <!-- Detak Jantung -->
                <div class="col-6 col-md-4">
                  <div class="p-3 border rounded bg-light text-center">
                    <small class="text-muted d-block">Detak Jantung</small>
                    <span class="fs-4 fw-bold text-dark">
                      [[${record.heartRate != null ? record.heartRate : '-'}]] <small class="fs-6">bpm</small>
                    </span>
                  </div>
                </div>
              </div>

              <h6 class="border-bottom pb-2 mb-3 fw-bold text-primary">Gaya Hidup & Kondisi</h6>
              <ul class="list-group list-group-flush mb-4">
                <li class="list-group-item d-flex justify-content-between">
                  <span>ðŸ’§ Air Minum</span>
                  <span class="fw-bold">[[${record.waterIntake}]] Gelas</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span>ðŸ’¤ Durasi Tidur</span>
                  <span class="fw-bold">[[${record.sleepDuration}]] Jam</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <span>âš¡ Tingkat Stres</span>
                  <span class="badge bg-info text-dark">Level [[${record.stressLevel}]]/10</span>
                </li>
              </ul>

              <h6 class="border-bottom pb-2 mb-2 fw-bold text-primary">Catatan Tambahan</h6>
              <div class="p-3 bg-light rounded border">
                <p class="mb-0 fst-italic text-dark" th:text="${record.notes != null && record.notes != '' ? record.notes : 'Tidak ada catatan tambahan.'}"></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Include Modal Edit Foto -->
      <!-- Pastikan path fragment sesuai dengan tempat kamu menyimpan file modal tadi -->
      <div th:replace="~{fragments/modals :: editPhotoModal}"></div>
    </div>

    <!-- Scripts untuk Auto Open Modal jika Error -->
    <script layout:fragment="others-js">
      document.addEventListener("DOMContentLoaded", function () {
        /* Cek error upload foto */
        var editPhotoModalOpen = "[[${editPhotoModalOpen}]]"; // Perhatikan, thymeleaf merender string
        
        // Cek jika nilainya ada (bukan null/kosong)
        if (editPhotoModalOpen && editPhotoModalOpen !== "null" && editPhotoModalOpen !== "") {
          var photoModal = new bootstrap.Modal(
            document.getElementById("editPhotoModal")
          );
          photoModal.show();
        }
      });
    </script>
  </body>
</html>